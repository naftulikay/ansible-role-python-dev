---
- name: download pyenv installer
  get_url:
    url: https://raw.githubusercontent.com/pyenv/pyenv-installer/master/bin/pyenv-installer
    dest: "{{ pyenv_tmp_installer }}"
    mode: "0755"
  when: not pyenv_installed

- name: install pyenv as the user
  command: "{{ pyenv_tmp_installer }} -y"
  become: true
  become_user: "{{ python_user }}"
  when: not (pyenv_installed | bool)

- name: install profile script
  template:
    src: pyenv.sh.j2
    dest: /etc/profile.d/pyenv.sh
    owner: root
    group: root
    mode: "0755"

- name: remove temp installer
  file: name="{{ pyenv_tmp_installer }}" state=absent
